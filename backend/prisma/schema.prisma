generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum VehicleStatus {
  AVAILABLE
  IN_USE
  MAINTENANCE
  TRANSFERRED
}

enum RouteLogStatus {
  ACTIVE
  FINISHED
  TRANSFERRED
}

model Document {
  id             Int      @id @default(autoincrement())
  type           String
  filePath       String
  fileName       String
  issueDate      DateTime
  expirationDate DateTime
  vehicleId      Int
  vehicle        Vehicle  @relation(fields: [vehicleId], references: [id])
  createdAt      DateTime @default(now())
}

model Vehicle {
  id                    Int            @id @default(autoincrement())
  plateNumber           String         @unique
  circulationPermitDate DateTime
  technicalReviewDate   DateTime
  insuranceDate         DateTime
  gasesReviewDate       DateTime

  status                VehicleStatus  @default(AVAILABLE)

  documents             Document[]
  routeLogs             RouteLog[]

  activeRouteLog        RouteLog?      @relation("ActiveRoute", fields: [activeRouteLogId], references: [id])
  activeRouteLogId      Int?           @unique

  createdAt             DateTime       @default(now())
  updatedAt             DateTime       @updatedAt
}

model RouteLog {
  id               Int           @id @default(autoincrement())
  driverName       String
  startMileage     Int
  endMileage       Int?
  startDate        DateTime
  endDate          DateTime?

  notesStart       String?
  notesEnd         String?

  imagesStart      String[]      @default([])
  imagesEnd        String[]      @default([])

  receiverName     String?
  receiverSignature String?

  status           RouteLogStatus @default(ACTIVE)

  transferTo       String?

  vehicleId        Int
  vehicle          Vehicle        @relation(fields: [vehicleId], references: [id])

  activeVehicle    Vehicle?       @relation("ActiveRoute")
}
